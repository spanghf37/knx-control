var mysql = require('mysql');

var mysqlconnection = mysql.createPool({
	connectionLimit : 10,
	host: process.env.MYSQL_HOST, 
	user: process.env.MYSQL_USER,
	password: process.env.MYSQL_PASSWORD,
	database: process.env.MYSQL_DATABASE
});

//mysqlconnection.connect(function(err) {
//	if (err) throw err;
//	console.log("*** mysqlconnection : connected to mysql database");
//});

var sql = "ALTER DATABASE " + process.env.MYSQL_DATABASE + " charset=utf8";
mysqlconnection.query(sql, function (err, result) {
   if (err) {
	  console.log(err);
   }
   else{
  	  console.log("UTF8 set to database");
   }
});

var sql = "DROP TABLE IF EXISTS knx_ga";
mysqlconnection.query(sql, function (err, result) {
  if (err) {
	  console.log(err);
  }
  else {
 	  console.log("Table knx_ga created");
  }
});

var sql = "CREATE TABLE IF NOT EXISTS knx_ga (knx_ga_groupname TEXT, knx_ga_address TINYTEXT, knx_ga_central TINYTEXT, knx_ga_unfiltered TEXT, knx_ga_description TEXT, knx_ga_datapointtype TEXT, knx_ga_security TEXT, knx_ga_id INT(11) AUTO_INCREMENT PRIMARY KEY, knx_ga_value TEXT, knx_ga_dptsubtypeunit TEXT, knx_ga_timestamp TEXT, knx_ga_src TEXT)";
mysqlconnection.query(sql, function (err, result) {
  if (err) {
	  console.log(err);
  }
  else {
 	  console.log("Table knx_ga created");
  }
});

var sql = "CREATE TABLE IF NOT EXISTS knx_monitor (knx_monitor_id INT(11) AUTO_INCREMENT PRIMARY KEY, knx_monitor_timestamp TEXT, knx_monitor_src TINYTEXT, knx_monitor_dest TINYTEXT, knx_monitor_value TINYTEXT, knx_monitor_comment TEXT, knx_monitor_dptsubtypeunit TEXT)";
mysqlconnection.query(sql, function (err, result) {
   if (err) {
	  console.log(err);
   }
   else{
  	  console.log("Table knx_monitor created");
   }
});

require('module_csv2mysql');

exports.mysqlconnection = mysqlconnection;
