var knx = require("knx");

var checkga = "0/1/50";  //KNX group address to check
var checkgadpt = "DPT1"; //KNX DPT type of checked group address

var myknxhealthconnection = knx.Connection({
	//ipAddr: "192.168.0.30",
	//ipPort: "3671",
	//debug: true,
	//interface: 'eth0',
	//useMulticastTunneling: true,
	//physAddr: process.env.KNX_SOURCEADDRESS,
	handlers: {
		connected: function() {
			function checkdp() {
				var dp = new knx.Datapoint({
					ga: checkga,
					dpt: checkgadpt
				}, myknxhealthconnection);
				dp.read((src, value) => {
					console.log("**** HEALTHCHECK : success, GA %j reports current value: %j", checkga, value);
					process.exit(0);
				});
				setTimeout(function () { 
					console.log("HEALTHCHECK : error, connection to KNX bus and/or healthcheck group address timed out");
					process.exit(1); }, 2000);
			}
			checkdp();
			//setTimeout(checkdp, 2000);
		}
	}
});
