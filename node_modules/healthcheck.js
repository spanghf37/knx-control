require('dotenv').config({path: './../.env'})
var request = require("request"); // HTTP POST vers serveur EMONCMS

var json = {};
//json[dest.toString().replace(/\//g, "-")] = knxdatapoint.current_value;
//Set the headers
var headers = {
	"content-type": "application/json"
};
//Configure the request

var getinputemoncms = {
	url: "http://" + process.env.EMONCMS_HOST + "/emoncms/feed/timevalue.json?id=12" + "&apikey=" + process.env.EMONCMS_APIKEY,
	method: "GET",
	encoding: "utf8",
	headers: headers
};

request(getinputemoncms, function(error, response, body) {
	if (!error && response.statusCode === 200) {
		var jsongetinput = JSON.parse(body);
		console.log("Log réponse : " + body);
		var timelastinput = JSON.stringify(jsongetinput.time); // id de l"input de EMONCMS correspondant à la key (qui est elle égale au GA KNX)
		console.log("parse : " + timelastinput);
		var timediff = new Date() - timelastinput;
		console.log("timediff : " + timediff);
		
	} else {
		console.log("error: " + error)
	}
});
